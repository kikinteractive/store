/**
 * store.js v1.0
 * Bindable & persistent storage
 * Copyright (c) 2012 Kik Interactive, http://kik.com
 * Released under the MIT license
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */



this.JSON||(this.JSON={});
(function(){function g(a){return 10>a?"0"+a:a}function h(a){m.lastIndex=0;return m.test(a)?'"'+a.replace(m,function(a){var i=s[a];return"string"===typeof i?i:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function n(r,d){var i,p,k,g,l=c,j,f=d[r];f&&"object"===typeof f&&"function"===typeof f.toJSON&&(f=f.toJSON(r));"function"===typeof a&&(f=a.call(d,r,f));switch(typeof f){case "string":return h(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);case "object":if(!f)return"null";
c+=o;j=[];if("[object Array]"===Object.prototype.toString.apply(f)){g=f.length;for(i=0;i<g;i+=1)j[i]=n(i,f)||"null";k=0===j.length?"[]":c?"[\n"+c+j.join(",\n"+c)+"\n"+l+"]":"["+j.join(",")+"]";c=l;return k}if(a&&"object"===typeof a){g=a.length;for(i=0;i<g;i+=1)p=a[i],"string"===typeof p&&(k=n(p,f))&&j.push(h(p)+(c?": ":":")+k)}else for(p in f)Object.hasOwnProperty.call(f,p)&&(k=n(p,f))&&j.push(h(p)+(c?": ":":")+k);k=0===j.length?"{}":c?"{\n"+c+j.join(",\n"+c)+"\n"+l+"}":"{"+j.join(",")+"}";c=l;return k}}
"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+g(this.getUTCMonth()+1)+"-"+g(this.getUTCDate())+"T"+g(this.getUTCHours())+":"+g(this.getUTCMinutes())+":"+g(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var q=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c,o,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a;"function"!==typeof JSON.stringify&&(JSON.stringify=function(h,d,i){var g;o=c="";if(typeof i==="number")for(g=0;g<i;g=g+1)o=o+" ";else typeof i==="string"&&(o=i);if((a=d)&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number"))throw Error("JSON.stringify");return n("",{"":h})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,d){function i(a,g){var c,h,f=a[g];if(f&&typeof f==="object")for(c in f)if(Object.hasOwnProperty.call(f,
c)){h=i(f,c);h!==void 0?f[c]=h:delete f[c]}return d.call(a,g,f)}var g,a=String(a);q.lastIndex=0;q.test(a)&&(a=a.replace(q,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){g=eval("("+a+")");return typeof d==="function"?i({"":g},""):g}throw new SyntaxError("JSON.parse");})})();
(function(g,h,n,q){function m(b){if("string"!==typeof b)throw TypeError("key must be a string, got "+b);}function c(b,a){function d(a){m(a);var b=f[a],e;if(b)for(var c=0,g=b.length;c<g;c++)e=b[c],h[e.type](a,e.listener,e.transform)}switch(typeof b){case "string":a=b;case "undefined":b={};case "function":case "object":break;default:throw TypeError("store must be an object, got "+b);}switch(typeof a){case "string":if(!a)throw TypeError("namespace may not be the empty string");s.enabled||(a=null);case "undefined":break;
default:throw TypeError("namespace must be a string if defined, got "+a);}var c={},f={},h={"function":function(a,b){try{b(a,c[a])}catch(e){g.console&&g.console.error&&g.console.error(e+"")}},node:function(a,b){var e=c[a]+"";"undefined"!==typeof b.innerText?b.innerText=e:"undefined"!==typeof b.textContent&&(b.textContent=e)},transform:function(a,b,e){var d="";try{d=e(a,c[a])}catch(f){g.console&&g.console.error&&g.console.error(f+"");return}b.innerHTML=d}};if(a){var i=o+a+"__",j=i.length;try{var k=
s.getAll(),l;for(l in k)l.substr(0,j)===i&&(c[l.substr(j)]=k[l])}catch(n){}}b.bind=function(a,b,e){m(a);switch(typeof e){case "undefined":case "function":break;default:throw TypeError("transform must be a function, got "+e);}var c={listener:b};if("function"===typeof b)c.type="function";else{var d;a:if(b){try{d=b instanceof Node||b instanceof HTMLElement;break a}catch(g){}d="object"!==typeof b||"number"!==typeof b.nodeType||"string"!==typeof b.nodeName?!1:!0}else d=!1;if(d)e?(c.type="transform",c.transform=
e):c.type="node";else throw TypeError("listener must be a function or DOM node, got "+b);}f[a]?f[a].push(c):f[a]=[c]};b.unbind=function(b,a){m(b);var e=f[b];if(e)for(var c=e.length;c--;)e[c].listener===a&&e.splice(c,1)};b.get=function(b){m(b);return c[b]};b.has=function(b){m(b);return"undefined"!==typeof c[b]};b.set=function(b,f){m(b);c[b]=f;if(a)try{s.set(o+a+"__"+b,f)}catch(g){}d(b)};b.del=function(b){m(b);delete c[b];if(a)try{s.remove(o+a+"__undefined")}catch(f){}d(b)};b.snapshot=function(){var b=
{},a;for(a in c)b[a]=c[a];return b};return b}var o="__STORE__",s,h=g,a={},r=h.document,d;a.disabled=!1;a.set=function(){};a.get=function(){};a.remove=function(){};a.clear=function(){};a.transact=function(b,e,c){var d=a.get(b);null==c&&(c=e,e=null);"undefined"==typeof d&&(d=e||{});c(d);a.set(b,d)};a.getAll=function(){};a.serialize=function(b){return JSON.stringify(b)};a.deserialize=function(b){return"string"!=typeof b?void 0:JSON.parse(b)};var i;try{i="localStorage"in h&&h.localStorage}catch(p){i=
!1}if(i)d=h.localStorage,a.set=function(b,e){if(void 0===e)return a.remove(b);d.setItem(b,a.serialize(e))},a.get=function(b){return a.deserialize(d.getItem(b))},a.remove=function(b){d.removeItem(b)},a.clear=function(){d.clear()},a.getAll=function(){for(var b={},e=0;e<d.length;++e){var c=d.key(e);b[c]=a.get(c)}return b};else{var k;try{k="globalStorage"in h&&h.globalStorage&&h.globalStorage[h.location.hostname]}catch(u){k=!1}if(k)d=h.globalStorage[h.location.hostname],a.set=function(b,e){if(void 0===
e)return a.remove(b);d[b]=a.serialize(e)},a.get=function(b){return a.deserialize(d[b]&&d[b].value)},a.remove=function(b){delete d[b]},a.clear=function(){for(var b in d)delete d[b]},a.getAll=function(){for(var b={},e=0;e<d.length;++e){var c=d.key(e);b[c]=a.get(c)}return b};else if(r.documentElement.addBehavior){var l,j;try{j=new ActiveXObject("htmlfile"),j.open(),j.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>'),j.close(),l=j.w.frames[0].document,d=l.createElement("div")}catch(f){d=
r.createElement("div"),l=r.body}var h=function(b){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(d);l.appendChild(d);d.addBehavior("#default#userData");d.load("localStorage");e=b.apply(a,e);l.removeChild(d);return e}},t=RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");a.set=h(function(b,e,c){e=e.replace(t,"___");if(void 0===c)return a.remove(e);b.setAttribute(e,a.serialize(c));b.save("localStorage")});a.get=h(function(b,e){e=e.replace(t,"___");return a.deserialize(b.getAttribute(e))});
a.remove=h(function(b,a){a=a.replace(t,"___");b.removeAttribute(a);b.save("localStorage")});a.clear=h(function(b){var a=b.XMLDocument.documentElement.attributes;b.load("localStorage");for(var c=0,d;d=a[c];c++)b.removeAttribute(d.name);b.save("localStorage")});a.getAll=h(function(b){var c=b.XMLDocument.documentElement.attributes;b.load("localStorage");for(var b={},d=0,f;f=c[d];++d)b[f]=a.get(f);return b})}}try{a.set("__storejs__","__storejs__"),"__storejs__"!=a.get("__storejs__")&&(a.disabled=!0),
a.remove("__storejs__")}catch(v){a.disabled=!0}a.enabled=!a.disabled;s=a;c(c,o);n&&(n.store=c,n.extend(n.fn,{storeBind:function(b,a,d){"string"===typeof b&&(d=a,a=b,b=c);this.forEach(function(c){b.bind(a,c,d)})},storeUnbind:function(b,a){"string"===typeof b&&(a=b,b=c);this.forEach(function(c){b.unbind(a,c)})}}));q&&(q.store=c,q.fn.storeBind=function(b,a,d){if(typeof b==="string"){d=a;a=b;b=c}this.each(function(){b.bind(a,this,d)})},q.fn.storeUnbind=function(a,d){if(typeof a==="string"){d=a;a=c}this.each(function(){a.unbind(d,
this)})});g.Store=c})(window,document,window.Zepto,window.jQuery);
